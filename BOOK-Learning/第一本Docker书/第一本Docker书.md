---
title: 第一本Docker书
date: 2017-08-03
---

# 第一本Docker书
## 简介
### 容器技术：
* 和传统的管理程序虚拟化(通过中间层将一台或多台独立的机器虚拟运行于物理硬件之上)不同,容器直接运行在操作系统内核之上的用户空间，相比传统的虚拟化和半虚拟化，容器不需要模拟层和管理层，而使用操作系统的系统调用接口，因此需要更小的开销。因此容器虚拟化也被称为"操作系统级虚拟化"，可以让多个独立用户空间运行在同一台宿主机上。
* 相比于彻底隔离的虚拟机等管理程序虚拟化，容器以操作系统为基础，因此容器只能运行与底层宿主机相同或相似的系统(如在ubuntu服务器上不支持运行windows)
* 适用于超大规模的多租户服务部署，轻量级沙盒，以及对安全要求不太高的隔离环境中，如“权限隔离监牢”。
* 得益于现代Linux内核的控件组(control group)，命名空间(namespace)等特性，使得容器和宿主机间的隔离更加彻底，容器拥有独立的网络和存储栈，拥有自己的资源管理能力，同时容器技术引入OpenVZ,Solaris Zones以及Linux容器(lxc)

### Docker简介：
* Docker为一个能够把开发的应用程序自动部署到容器的开源引擎，其在虚拟化的容器执行环境中增加一个应用程序部署引擎(提供轻量快速的程序运行环境，方便从开发到测试到生产的环境迁移/部署)， 从而简化了容器技术安装/管理/自动化的复杂性，
* Docker优势/目标:
    * 提供简单,轻量的建模方式：易使用，写时修改，启动快，额外开销小。
    * 职责的逻辑分离:开发／运维职责分离，保证开发环境生产环境一致性；
    * 快速高效的开发生命周期，应用可移植，易构建，易部署，易协作；
    * 鼓励面向服务的架构:Docker推荐单个容器只运行一个应用程序或进程，应用程序和服务都可以表示为一系列内部互联的容器，从而形成分布式的应用程序模型，在面向服务的架构和微服务架构使分布式部署应用程序，扩展或调试应用程序变得简单，提高程序的内省性；
* Docker组件:
    * Docker客户端和服务器：Docker为C/S架构，客户端只需向Docker服务器或守护进程(位于中间/消息转发)发送请求，服务器或守护进程将完成工作并返回结果。提供命令行工具及RESTful API，此外也可以通过本地客户端连接另一台宿主机上的远程Docker守护进程。
    * Docker镜像:镜像为基于联合文件系统的层次结构，由一系列命令一步一步构建出来(DockerFile),Docker基于镜像构建运行容器，可以将中间的镜像保存到公有或私有的Registry中，如Docker Hub
    * 容器:只需将应用程序打包放进容器(镜像)，由Docker来基于镜像构建和部署容器，Docker容器具有方便替换,可叠加，易分发，通用性强的特点
* Docker应用场景:
    * 1.基于容器开发，方便环境迁移，加速开发构成流程；
    * 2.适用微服务架构，单服务独立环境分布式运行；
    * 3.创建隔离的测试环境
    * 4.高性能超大规模的宿主机部署；
* Docker配置管理:
    *传统镜像管理(如"黄金镜像"模型)可能充斥大量无管理状态镜像，往往造成混乱笨重的情况，相比之下Docker的分层机制，可迅速迭代更加轻量化。
    * 同时对不同的宿主机／程序和服务，Docker可能会表现出不同的特性和架构；
* Docker的技术组件:
    * Docker可运行于任何安装了现代linux内核的x64主机上(现在也支持window10)，包含:
        * 一个原生的Linux容器格式(Docker中称为libcontainer,默认容器格式)或lxc
        * Linux内核的命名空间，用于隔离文件系统，进程和网络；
        * 文件系统隔离:每个容器有自己的root文件系统;
        * 进程隔离:每个容器运行在自己的进程环境中;
        * 网络隔离:容器间的虚拟网络接口和ip地址都是公开的；
        * 资源隔离和分组:利用cgroup(控制分组)将CPU和内存等资源独立分配给每个Docker容器；
        * 写时复制:文件系统通过写时复制创建，文件系统分层，快速，且占用的磁盘空间更小;
        * 日志:容器产生的STDOUT,STDERR,STDIN这些IO流都会被收集并记入日志，可通过日志分析进行故障排错
        * 交互式Shell:可创建一个伪tty终端(连接到STDIN)

## Docker入门:
### 常用命令:
* docker info: 查看Docker当前使用以及配置信息;
* docker run -it \[image_name\] /bin/bash ：根据指定镜像创建/启动docker容器(-i保证容器内开启STDIN以支持交互式shell,-t为创建的容器分配一个伪tty终端),并且容器启动后
执行"/bin/bash"命令 
    * --name [container_name]:指定容器名称，默认随机生成，可利用名称，长/短ID标识唯一容器
    * －d:创建长期运行的守护式进程，无交互式会话适合运行应用程序和服务(默认为交互式容器，执行exit退出容器的shell后，容器停止运行):
    * --restart=[always/on-failure:N]:根据容器退出代码决定是否重启容器
* docker ps: 查看容器列表，默认列出运行的容器(-a列出当前存在的所有容器，－q只返回容器id)
* docker inspect　[name/id]：查看容器详细信息，会对容器进行详细检查，返回其详细配置信息;
> 此外/var/lib/docker目录存放着Docker镜像,容器以及容器配置等，可通过浏览该目录深入了解Docker工作原理
* docker start/restart [name or id] :启动／重启一个容器，启动后会沿用docker run创建容器时，定义的参数
    *docker attach [name or id]： 启动／重启容器后，重新附着到容器的会话／终端shell上；
* docker logs [name/id]: 可以查看获取(后台)容器的输出日志:
    * -f:实时跟踪监控日志输出
    * --tail [Num]:获取部分日志
    * -t: 在每条输出日志前面添加时间戳
* docker top [name/id]：　查看容器内部运行的进程
* docker exec -d [name/id] [shell command]：在docker内部启动新的进程，
    * -d:后台运行，默认为交互式前台运行
    * -i -t：同docker run中参数，创建/进入一个tty终端
* docker stop [name/id]: 停止(守护式)容器，会向Docker容器进程发送SIGTERM信号,此外docker kill会向容器进程发送SIGKILL信号，可快速停止某个容器
* docker rm [name/id]: 删除停止运行的容器
    
