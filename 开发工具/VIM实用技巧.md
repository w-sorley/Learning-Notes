---
title: VIM实用技巧
tags: [编辑器, VIM, 编程技巧, 提高效率]
---

# VIM 实用技巧

### 常用命令
:h vimtutor ，打开vim向导
:h key-notation ,自定义按键映射项
:h feature-list, 查看功能列表
> 备注：vim的功能集分为small,normal,big,huge,在编译期可选，如，参数--with-feature=tiny只会编译最基本的功能
:h gui, 查看vim GUI版相关信息 

vim -u NONE -N :不加载vimrc(-u指定加载文件路径，默认会进入vi兼容模式，导致很多功能被禁用，-u指定加载文件路径),同时使能“nocompatible”选项，防止进入vim兼容模式
激活vim内置插件最小配置：
```
set nocompatible
filetype plugin on
```

“/”， 用命令行模式执行正向查找；
“?”, 用命令行模式执行反向查找
"="， 用命令行模式，对一个vim脚本表达式进行求值


## Chapter 1: VIM解决问题的方式
* 概述:VIM对重复性操作进行了优化：会记录我们最近的操作，使我们可以一次按键即可重复上次操作，因此我们应该学会规划按键动作。
### Skill 1: 结识.命令
* “.”命令：重复上次修改(操作模式:一次按键移动，另一次按键执行）
* 常见修改:    
    * x :删除当前光标下的字符
    * dd ：删除当前光标所在行
    * >G : 增加从当前行到文档末尾的缩进层级
    * VIM从进入插入模式起，直到返回普通模式期间的所有操作，可作为一次修改(在插入模式中移动光标会重置修改状态)
* “.“是一个微型的宏，VIM可支持录制任意数目的按键操作，并在以后用一个按键重放

### Skill 2:不要自我重复
* $ 移动到当前行的末尾
* a 在当前光标字符的后面开始编辑
* A 在当前所在行的末尾后面开始编辑(可代替$a,结合.可用于重复在多行末尾添加相同内容)
* 很多单键VIM命令都可以看作是两个或多个其他命令的组合，如(从普通模式到插入模式):
    * C    :     c$   删除当前位置到行末尾的所有内容(包括当前位置)，并在行尾位置开始编辑
    * s    ：    cl   删除当前光标所在位置字符，并在当前位置开始编辑
    * S    ：    ^c  ?   删除所在行: 删除当前光标所在位置到行首字符，并在行首位置开始编辑
    * I    ：    ^i   在当前行首开始编辑
    * A    ：    $a   在所在行的末尾后面开始编辑
    * o    ：    A<CR>  在当前行下面插入一个新行，并在新行行首位置开始编辑
    * O    ：    ko   在当前行的上面插入一个新行，并在新行行首位置开始编辑
### Skill 3：以退为进
* 使修改可重复
    * f{字符} : 定位到要修改处(f{char}/t{char}在行内查找下一指定字符,对应的F/T反向查找)
    * s{修改操作}<Esc> : s删除当前光标下字符,并进入插入模式;在插入模式下执行修改然后退出
    * ;. : ;会重复上次f命令查找下一个定位,再次执行修改(可依次修改多处)
### Skill 4: 执行,重复,回退
* @:命令: 重复任意Ex命令
* &命令: 重复上次的:substitute

* ,命令: 反方向查找上次f所查找的字符(与;相反)
* /pattern<CR>命令: 在文档中查找下一处匹配项(对应?命令为反向),n命令重复查找(N回退)
* :s/target/replacement命令: 执行替换,&命令重复上次替换(u回退),:%s/target/replacement/g命令全局替换
* qx{changes}q命令: 执行一系列修改(@x重复,u回退)

### Skill 5 查找并手动替换
* \*命令: 会查找下一个当前光标下的单词(所有单词会高亮,:set hls开启匹配高亮)
* cw命令: 删除光标当前所在单词,并进入插入模式

### Skill 6 结识.范式
* 理想模式: 用一键移动,另一键执行

# 第一部分:模式
## chapter 普通模式
* 许多普通模式的命令可以在执行时指定执行的次数
* 普通模式命令的强大,很大程度源于它可以把操作符与动作命令结合在一起

### Skill 7 停顿时请移开画笔
* 编辑人员可能只是花很少的一部分时间编写/修改代码,大部分时间都在浏览,思考;
* 但确实需要修改时,也可能只是调整已有的代码,从而可以大部分时间都在VIM的普通模式下完成

### Skill 8 把撤销单元切成块
* 在VIM中利用u键执行撤销命令,撤销最新的修改,我们可以自己控制撤销的粒度(通过\<ESC\>)
* 从进入插入模式开始开始,直到\<ESC\>返回普通模式为止,在此期间执行的操作都被当做一次修改
> 通常将一次思考的过程作为一次修改,当遇到(思考上的)提顿时,可以即是提示我们应该\<ESC\>退出,
  此外,比如可以利用\<ESC\>o来另起一行(则上一行的编辑可作为一次修改)
* 在插入模式中移动光标会重置修改状态

  ### Skill 9 构造可重复的修改
* 反向删除:
    * db命令:删除从光标起始位置到单词开头的内容(不包括光标所在位置)
    * x命令: 删除当前字符
* 正向删除:
    * b命令: 将光标移动到单词开头
    * dw命令: 删除光标位置到下个单词开头的内容
* 删除整个单词
    * daw命令: 会删除一个单词(aw为文本对象),同时会删除一个空格,光标停留在上个单词的末尾字符,可重复性更强
* 在VIM中实现同样的修改,可能会有多种操作方式,我们通常会考虑操作的效率(按键次数)和可重复性
### Skill 10 用次数做简单的算术运算
* 很多普通模式命令都可以带一个次数前缀,从而可以基于此进行简单的算术运算
    * N\<C-a\>:把当前光标之上或之后的数值加上N(会在当前行正向查找一个数字,找到则跳转到数字位置,并执行修改,;对应的N\<C-a\>命令为执行减操作)
> VIM会把以0开头的单词当做八进制处理,如对007执行\<C-a\>会变为010(可通过set nrformats=来修改)
* cw命令: 删除当前单词并进入插入模式(c命令删除光标到指定跳转位置的内容,并进入到插入模式)

### Skill 11 能够重复,就别用次数
* 删除指定个数的单词,可有有多种操作方式.如:d{count}w命令;{count}dw命令;dw和多个.命令;
    * 通常更倾向于使用dw和.命令,这样每次修改的粒度更低,可以很容易的利用u命令进行恢复,利用.命令进行重复(执行,重复,回退)
* 只在必要时使用次数:
    * 如删除多个单词-替换为指定的内容,可以执行c{count}w{编辑修改}\<ESC\>,相比利用.命令重复删除,可以直接进入插入模式(无需使用i或cw)
    * 使用次数的另一个好处是:它保留了一个干净,连贯的撤销历史记录;(可以利用u撤销整个修改)

### Skill 12 双剑合璧,天下无敌
* VIM的强大很大程度上源自操作符与动作命令相结合:操作符+动作命令=操作:
    * d{motion}命令可以对一个字符(dl),一个完整单词(daw),或一整个段落(dap)进行操作,类似的命令,还有c{motion},y{motion}等,它们统称为操作符(可通过h operator查阅完整列表)
    * g\~,gu,gU命令也是一个操作符(需要两次按键,其中g作为前缀字符用以改变其后按键行为),用以转换大小写
    * VIM的语法只有一条额外规则,即当一个操作符命令被连续调用两次时,它会作用于当前行(如\>\>会缩进当前行);
* 其他操作符:
    * c: 修改
    * y: 复制到寄存器
    * \<: 减小缩进
    * \=: 自动缩进
    * \!: 使用外部程序过滤{motion}所跨越的行
* 我们还可以通过自定义动作命令以及操作符来进一步增强命令组合的威力:
    * 自定义操作符(参考h :map-operator)与已有动作命令协同工作:
        * commentary.vim插件便是一个好的例子,其为VIM所支持的编程语言增添了注释以及取消注释的命令
            * \\\\{motion}触发注释命令,为一个操作符命令,可与其他动作命令结合
    * 自定义动作命令与已有操作符协同工作:可以定义新的动作命令以及文本对象(参考h omap-info)
        * textobj-entire插件是一个好的例子,其为VIM增加了两种新的文本对象ie和ae,可作用于整个文件
            * =ae命令: 可为整个文件自动缩进;
* 操作符待决模式:
    * 指操作符和动作命令键之间的短暂时间间隔,此模式只接受动作命令(可利用\<ESc\>退回到普通模式)
    * 有些命令可能需要多个按键,但第一按键按下并不会进入操作符待决模式(可把它们当成namespace用以扩充可用命令的数目)

## 插入模式
### Skill 13 在插入模式中可即时更正错误








