---
title: VIM实用技巧
tags: [编辑器, VIM, 编程技巧, 提高效率]
---

# VIM 实用技巧

### 常用命令
:h vimtutor ，打开vim向导
:h key-notation ,自定义按键映射项
:h feature-list, 查看功能列表
> 备注：vim的功能集分为small,normal,big,huge,在编译期可选，如，参数--with-feature=tiny只会编译最基本的功能
:h gui, 查看vim GUI版相关信息 

vim -u NONE -N :不加载vimrc(-u指定加载文件路径，默认会进入vi兼容模式，导致很多功能被禁用，-u指定加载文件路径),同时使能“nocompatible”选项，防止进入vim兼容模式
激活vim内置插件最小配置：
```
set nocompatible
filetype plugin on
```

“/”， 用命令行模式执行正向查找；
“?”, 用命令行模式执行反向查找
"="， 用命令行模式，对一个vim脚本表达式进行求值


## Chapter 1: VIM解决问题的方式
* 概述:VIM对重复性操作进行了优化：会记录我们最近的操作，使我们可以一次按键即可重复上次操作，因此我们应该学会规划按键动作。
### Skill 1: 结识.命令
* “.”命令：重复上次修改(操作模式:一次按键移动，另一次按键执行）
* 常见修改:    
    * x :删除当前光标下的字符
    * dd ：删除当前光标所在行
    * >G : 增加从当前行到文档末尾的缩进层级
    * VIM从进入插入模式起，直到返回普通模式期间的所有操作，可作为一次修改(在插入模式中移动光标会重置修改状态)
* “.“是一个微型的宏，VIM可支持录制任意数目的按键操作，并在以后用一个按键重放

### Skill 2:不要自我重复
* $ 移动到当前行的末尾
* a 在当前光标字符的后面开始编辑
* A 在当前所在行的末尾后面开始编辑(可代替$a,结合.可用于重复在多行末尾添加相同内容)
* 很多单键VIM命令都可以看作是两个或多个其他命令的组合，如(从普通模式到插入模式):
    * C    :     c$   删除当前位置到行末尾的所有内容(包括当前位置)，并在行尾位置开始编辑
    * s    ：    cl   删除当前光标所在位置字符，并在当前位置开始编辑
    * S    ：    ^c  ?   删除所在行: 删除当前光标所在位置到行首字符，并在行首位置开始编辑
    * I    ：    ^i   在当前行首开始编辑
    * A    ：    $a   在所在行的末尾后面开始编辑
    * o    ：    A<CR>  在当前行下面插入一个新行，并在新行行首位置开始编辑
    * O    ：    ko   在当前行的上面插入一个新行，并在新行行首位置开始编辑
### Skill 3：以退为进
* 使修改可重复
    * f{字符} : 定位到要修改处(f{char}/t{char}在行内查找下一指定字符,对应的F/T反向查找)
    * s{修改操作}<Esc> : s删除当前光标下字符,并进入插入模式;在插入模式下执行修改然后退出
    * ;. : ;会重复上次f命令查找下一个定位,再次执行修改(可依次修改多处)
### Skill 4: 执行,重复,回退
* @:命令: 重复任意Ex命令
* &命令: 重复上次的:substitute

* ,命令: 反方向查找上次f所查找的字符(与;相反)
* /pattern<CR>命令: 在文档中查找下一处匹配项(对应?命令为反向),n命令重复查找(N回退)
* :s/target/replacement命令: 执行替换,&命令重复上次替换(u回退),:%s/target/replacement/g命令全局替换
* qx{changes}q命令: 执行一系列修改(@x重复,u回退)

### Skill 5 查找并手动替换
* \*命令: 会查找下一个当前光标下的单词(所有单词会高亮,:set hls开启匹配高亮)
* cw命令: 删除光标当前所在单词,并进入插入模式

### Skill 6 结识.范式
* 理想模式: 用一键移动,另一键执行

# 第一部分:模式
## chapter 普通模式
* 许多普通模式的命令可以在执行时指定执行的次数
* 普通模式命令的强大,很大程度源于它可以把操作符与动作命令结合在一起

### Skill 7 停顿时请移开画笔
* 编辑人员可能只是花很少的一部分时间编写/修改代码,大部分时间都在浏览,思考;
* 但确实需要修改时,也可能只是调整已有的代码,从而可以大部分时间都在VIM的普通模式下完成

### Skill 8 把撤销单元切成块
* 在VIM中利用u键执行撤销命令,撤销最新的修改,我们可以自己控制撤销的粒度(通过\<ESC\>)
* 从进入插入模式开始开始,直到\<ESC\>返回普通模式为止,在此期间执行的操作都被当做一次修改
> 通常将一次思考的过程作为一次修改,当遇到(思考上的)提顿时,可以即是提示我们应该\<ESC\>退出,
  此外,比如可以利用\<ESC\>o来另起一行(则上一行的编辑可作为一次修改)
* 在插入模式中移动光标会重置修改状态

  ### Skill 9 构造可重复的修改
* 反向删除:
    * db命令:删除从光标起始位置到单词开头的内容(不包括光标所在位置)
    * x命令: 删除当前字符
* 正向删除:
    * b命令: 将光标移动到单词开头
    * dw命令: 删除光标位置到下个单词开头的内容
* 删除整个单词
    * daw命令: 会删除一个单词(aw为文本对象),同时会删除一个空格,光标停留在上个单词的末尾字符,可重复性更强
* 在VIM中实现同样的修改,可能会有多种操作方式,我们通常会考虑操作的效率(按键次数)和可重复性
### Skill 10 用次数做简单的算术运算
* 很多普通模式命令都可以带一个次数前缀,从而可以基于此进行简单的算术运算
    * N\<C-a\>:把当前光标之上或之后的数值加上N(会在当前行正向查找一个数字,找到则跳转到数字位置,并执行修改,;对应的N\<C-a\>命令为执行减操作)
> VIM会把以0开头的单词当做八进制处理,如对007执行\<C-a\>会变为010(可通过set nrformats=来修改)
* cw命令: 删除当前单词并进入插入模式(c命令删除光标到指定跳转位置的内容,并进入到插入模式)

### Skill 11 能够重复,就别用次数
* 删除指定个数的单词,可有有多种操作方式.如:d{count}w命令;{count}dw命令;dw和多个.命令;
    * 通常更倾向于使用dw和.命令,这样每次修改的粒度更低,可以很容易的利用u命令进行恢复,利用.命令进行重复(执行,重复,回退)
* 只在必要时使用次数:
    * 如删除多个单词-替换为指定的内容,可以执行c{count}w{编辑修改}\<ESC\>,相比利用.命令重复删除,可以直接进入插入模式(无需使用i或cw)
    * 使用次数的另一个好处是:它保留了一个干净,连贯的撤销历史记录;(可以利用u撤销整个修改)

### Skill 12 双剑合璧,天下无敌
* VIM的强大很大程度上源自操作符与动作命令相结合:操作符+动作命令=操作:
    * d{motion}命令可以对一个字符(dl),一个完整单词(daw),或一整个段落(dap)进行操作,类似的命令,还有c{motion},y{motion}等,它们统称为操作符(可通过h operator查阅完整列表)
    * g\~,gu,gU命令也是一个操作符(需要两次按键,其中g作为前缀字符用以改变其后按键行为),用以转换大小写
    * VIM的语法只有一条额外规则,即当一个操作符命令被连续调用两次时,它会作用于当前行(如\>\>会缩进当前行);
* 其他操作符:
    * c: 修改
    * y: 复制到寄存器
    * \<: 减小缩进
    * \=: 自动缩进
    * \!: 使用外部程序过滤{motion}所跨越的行
* 我们还可以通过自定义动作命令以及操作符来进一步增强命令组合的威力:
    * 自定义操作符(参考h :map-operator)与已有动作命令协同工作:
        * commentary.vim插件便是一个好的例子,其为VIM所支持的编程语言增添了注释以及取消注释的命令
            * \\\\{motion}触发注释命令,为一个操作符命令,可与其他动作命令结合
    * 自定义动作命令与已有操作符协同工作:可以定义新的动作命令以及文本对象(参考h omap-info)
        * textobj-entire插件是一个好的例子,其为VIM增加了两种新的文本对象ie和ae,可作用于整个文件
            * =ae命令: 可为整个文件自动缩进;
* 操作符待决模式:
    * 指操作符和动作命令键之间的短暂时间间隔,此模式只接受动作命令(可利用\<ESc\>退回到普通模式)
    * 有些命令可能需要多个按键,但第一按键按下并不会进入操作符待决模式(可把它们当成namespace用以扩充可用命令的数目)

## 插入模式
### Skill 13 在插入模式中可即时更正错误
* 在插入模式下可以使用以下命令删除文本(并不是VIM插入模式独有,在bash shell中同样适用):
    * \<C-h\>: 删除前一个字符(同退格键)
    * \<C-w\>: 删除前一个单词
    * \<C-u\>: 删除至行首
### Skill 14 返回普通模式
* 返回普通模式可选命令:
    * \<ESC\>: 切换到普通模式
    * \<C-\[\>: 切换到普通模式
    * \<C-o\>: 切换到插入-普通模式(在普通模式执行一条命令即自动返回插入模式)
* (普通模式)zz命令可以重绘屏幕,并把当前行显示在窗口正中
### Skill 不离开插入模式,粘贴寄存器中的文本
* 重新映射大小写转换键(Caps Lock):
    * 当大小写转换键处于大写模式时,我们可能默认执行的都是大写键触发的命令,如:
        * K命令: 用于查看当前光标下的单词的手册页(不同于k)
        * J命令: 用来把当前行和下一行连接在一起
    * 很多人(为避免大小写命令错误)会选择重映射caps lock键,将其当做\<ESC\>或\<Ctrl\>
* t\{char\}命令: 光标跳转到下一个对应字符前的位置
* (插入模式)\<C-r\>{register number}命令: 插入指定寄存器中的内容(相当于由键盘一个个输入,可能会出现不必要的换行和额外的缩进)  
* (插入模式)<C-r><C-p>{register命令:按照原义插入寄存器内的文本,并修正任何不必要的缩进

### Skill 16 随时随地做运算
* 表达式寄存器(可以用来执行一段Vim脚本,并返回其结果)允许我们做一些运算,并把运算结果直接插入到文档中
    * 可用=符号指明使用表达式寄存器,在插入模式中输入<C-r>=就可以访问这一寄存器,之后输入要执行的表达式,然后输入\<Enter\>确认结束,Vim就会把执行的结果插入到当前位置
### Skill 17 用字符编码插入非常用字符
* Vim可以使用字符编码(插入任意字符,可以很方便的输入键盘上找不到的符号(参看:h i_CTRL\-V\_digit):
    * (插入模式下)\<C-v\>{code}即可,其中code为3位数字或4为十六进制编码(u{XXXX})
    * 将光标移动到任意字符,使用ga命令可查看其编码
    * 如果\<C-v\>命令后面跟一个非数字键,它会插入这个按键本身所代表的字符
### 用二合字母插入非常用字符
* (插入模式下)\<C-k\>{char1}{char2},如(可参考:h digraphs-default):
    * 普通分数1/2,1/3用二合字母12,13表示
    * \?I表示反问号
### Skill 19 用替换模式替换已有文本
* 在替换模式中输入会替换文档中的已有文本,除此之外,该模式与插入模式完全相同
* \<Insert\>键可以在插入模式和替换模式之间切换
* 用虚拟替换模式替换制表符
    * 某些字符会使替换模式变得复杂化,如在替换模式下替换制表符,会直接替换N个字符(N由tabstop决定)
    * gR命令触发VIM的虚拟替换模式,该模式会把制表符当作一组空格进行处理,每次替换只是替换其中一个空格(安装显示宽度,而不是文件中保存的字符进行替换)
* Vim也提供单词版本的替换模式和虚拟替换模式,分别对应r{char},gr{char}命令,允许我们覆盖一个字符,之后立即回到普通模式

## 可视模式
* Vim的可视模式允许我们选中一块文本区域并在其上进行操作,其有三种不同的可视模式,分别用于操作字符文本,行文本或块文本.
### Skill20 深入理解可视模式
* 可视模式仅仅是另外一种模式,也就是说在此模式中,每个按键都完成一种不同的功能,
    * 有些与普通模式相同,如:
        * h,j,k,l移动光标
        * f{char}进行跳转(";",","正向/反向重复跳转)
        * 每次在可视模式中移动光标,都会改变高亮选区的边界
    * 与普通模式中先触发修改命令,在使用动作命令指定其作用范围不同;可视模式中对于所有的操作符命令均为先选中选区,然后进行再触发修改命令,如c命令删除指定文本并切换到插入模式
* 结识选择模式:
    * VIM 选择模式类似常见编辑器的选择模式,在此模式下输入可见字符会使所选中的文本被删除,同时进入插入模式;
    * \<C-g\>可以在选择模式和可视模式之间切换
### Skill 21 选择高亮选区 
* 面向字符的可视模式中,能够选择任意的字符范围,不论是单个字符,还是位于一行内,或是跨若干行的指定字符范围,该模式适用于操作单词或短语;而面向行的可视模式适合对整行进行操作;
* 激活可视模式
    * 普通模式下使用v键激活面向字符可视模式,
    * 使用V键可激活面向行的可视模式,
    * \<C-v\>键可激活面向列块的可视模式;
    * gv命令重选上次的高亮选区
* 在可视模式间切换
    * 与普通模式下的激活命令相同,但是在对应的可视模式下再次使用该可视模式对应的按键命令(如在面向字符的可视模式使用v命令)会回到普通模式;
* 切换选区的活动端:
    * 高亮选区的范围由其两个端点界定,其中一端固定,而另一端可以随光标自由移动
    * 可以使用o键切换其活动的端点
### Skill 22 重复执行面向行的可视命令
* 当使用.命令重复对高亮选区所做的修改时,此修改会作用于相同范围的文本
### Skill 23 只要可能,最好用操作符命令,而不是可视命令
* 在可视模式下.命令可能有时会有一些异常表现,可以用普通模式下的操作符命令来规避此缺点,如
    * 当一条可视模式命令被重复执行时,会影响相同数量的文本,而我们可能想要重复修改长度不固定的单词
    * 其他 it命令称为文本对象可以选中标签内的内容
    * 可视模式通常用于修改范围难以(用动作命令)精确选取的情况

### Skill 24 用面向列块的可视模式编辑表格数据
* 如统一调整各列的位置,在两个之间统一插入内容("|"等)

### Skill 25 修改列文本
* 可利用列块可视模式选择多列,然后c命令删除并进入插入模式,输入修改后的内容(会先出现在顶行),然后回到普通模式,会发现修改的内容出现在所有行     

### Skill 26 在长短不一的高亮块后添加文本
* 列块可视模式的选择区域不仅限于操作方形的文本区域:
    * 可以在进入列块可视模式后,利用$键把选区扩大到行尾(从而可以选择长短不一的各行)
    * 如然后A命令在行尾插入内容(如";"等),内容会首先出现在顶行,返回普通模式后出现在所有行的末尾
* Vim对"i"以及"a"键的约定
    * i将光标移动到字符后,a将光标移动到字符后,I将光标移动到行首,A将光标移动到行尾
    * 在可视模式中"I"和"A"已然遵循上面约定,而"i"和"a"则被当做一个文本对象的组成部分


## 命令行模式
* VIM发展:ed\-\>ex\-\>vi\-\>vim ;
### Skill27 结识Vim的命令行模式





